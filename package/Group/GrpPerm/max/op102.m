freeze;
/* 
    Maximal subgroups of  O+(10,2) and its aut group.
    Based on information in the Birmingham Atlas of Group Representations
    as at 18/2/04.

    Bill Unger, 18/2/04
*/

get_standard_gens_op102 := function(G)
    P := RandomProcess(G);
    repeat
	x := Random(P);
    until Order(x) eq 60;// 1 in 30
    a := x ^ 30; // a in 2A
    b := x ^ 3;  // b in 20A
    repeat
	b := b^Random(P);
    until Order(a*b) eq 21; // 32 in 1581, near 1 in 49
    return a,b;
end function;

Op102Identify := function(group:max:=true,Print:=0)
S := Sym(496);
a := S!
\[ 1, 170, 232, 340, 5, 6, 7, 455, 205, 306, 387, 156, 234, 85, 441, 89, 337, 18,
272, 443, 21, 70, 459, 484, 226, 26, 469, 445, 399, 473, 458, 460, 33, 34, 269, 
36, 37, 280, 39, 40, 307, 42, 152, 380, 357, 46, 47, 360, 444, 422, 51, 52, 240,
194, 410, 206, 298, 263, 171, 456, 419, 142, 197, 468, 74, 71, 471, 68, 496, 22,
66, 293, 463, 65, 262, 368, 79, 148, 77, 371, 162, 349, 145, 491, 14, 136, 210, 
225, 16, 431, 467, 92, 165, 132, 140, 466, 246, 119, 331, 100, 104, 199, 239, 
101, 429, 106, 332, 243, 228, 110, 111, 483, 113, 114, 115, 141, 442, 118, 98, 
120, 121, 259, 123, 124, 237, 160, 433, 164, 297, 216, 131, 94, 398, 134, 286, 
86, 266, 242, 277, 95, 116, 62, 373, 218, 83, 312, 403, 78, 258, 470, 439, 43, 
256, 230, 155, 12, 355, 402, 341, 126, 343, 81, 163, 128, 93, 166, 167, 461, 
196, 2, 59, 414, 214, 383, 348, 176, 270, 224, 179, 180, 400, 182, 183, 184, 
344, 289, 187, 188, 189, 465, 477, 192, 396, 54, 195, 169, 63, 309, 102, 326, 
244, 369, 203, 204, 9, 56, 479, 489, 221, 87, 352, 438, 213, 173, 215, 130, 334,
144, 219, 317, 209, 366, 223, 178, 88, 25, 393, 109, 338, 154, 492, 3, 374, 13, 
328, 476, 125, 257, 103, 53, 247, 138, 108, 201, 424, 97, 241, 248, 249, 339, 
421, 404, 253, 408, 364, 153, 238, 149, 122, 260, 430, 75, 58, 264, 412, 137, 
333, 386, 35, 177, 271, 19, 273, 274, 453, 379, 139, 278, 279, 38, 281, 282, 
350, 346, 321, 135, 449, 288, 186, 474, 475, 292, 72, 378, 295, 409, 129, 57, 
305, 486, 482, 376, 397, 304, 299, 10, 41, 417, 198, 480, 488, 146, 313, 324, 
315, 316, 220, 318, 415, 320, 285, 322, 323, 314, 454, 200, 432, 235, 391, 416, 
99, 107, 267, 217, 405, 336, 17, 229, 250, 4, 159, 372, 161, 185, 345, 284, 384,
175, 82, 283, 351, 211, 353, 354, 157, 356, 45, 427, 359, 48, 361, 362, 493, 
255, 365, 222, 367, 76, 202, 428, 80, 342, 143, 233, 382, 302, 394, 294, 276, 
44, 381, 375, 174, 347, 495, 268, 11, 490, 451, 390, 329, 392, 227, 377, 462, 
193, 303, 133, 29, 181, 401, 158, 147, 252, 335, 420, 407, 254, 296, 55, 411, 
265, 413, 172, 319, 330, 308, 485, 61, 406, 251, 50, 423, 245, 425, 426, 358, 
370, 105, 261, 90, 327, 127, 448, 435, 452, 437, 212, 151, 440, 15, 117, 20, 49,
28, 446, 447, 434, 287, 450, 389, 436, 275, 325, 8, 60, 457, 31, 23, 32, 168, 
395, 73, 464, 190, 96, 91, 64, 27, 150, 67, 472, 30, 290, 291, 236, 191, 478, 
207, 310, 481, 301, 112, 24, 418, 300, 487, 311, 208, 388, 84, 231, 363, 494, 
385, 69 ];
b := S!
\[ 115, 366, 216, 494, 310, 370, 54, 131, 447, 492, 91, 77, 296, 355, 358, 496, 
451, 23, 55, 332, 280, 177, 18, 368, 95, 357, 477, 114, 33, 303, 134, 233, 248, 
487, 271, 412, 314, 354, 107, 282, 346, 345, 157, 420, 130, 96, 417, 367, 328, 
361, 429, 222, 156, 317, 324, 128, 182, 232, 284, 192, 111, 302, 196, 195, 390, 
484, 342, 433, 19, 491, 62, 125, 145, 90, 101, 201, 4, 356, 113, 13, 108, 116, 
437, 234, 225, 226, 300, 383, 164, 389, 87, 214, 424, 459, 432, 122, 260, 335, 
395, 237, 75, 224, 288, 149, 210, 263, 51, 301, 229, 276, 152, 268, 422, 117, 
187, 425, 407, 289, 384, 171, 135, 181, 419, 42, 408, 85, 220, 142, 275, 403, 
15, 464, 262, 239, 71, 37, 49, 321, 93, 347, 186, 52, 476, 159, 306, 485, 329, 
208, 143, 349, 339, 393, 219, 305, 221, 423, 495, 290, 1, 20, 277, 211, 73, 151,
391, 180, 452, 428, 457, 392, 400, 474, 245, 291, 334, 106, 273, 21, 9, 126, 
362, 315, 161, 387, 293, 198, 144, 16, 398, 22, 402, 139, 350, 136, 246, 44, 
104, 493, 235, 81, 163, 455, 176, 376, 150, 360, 256, 471, 137, 253, 374, 479, 
344, 255, 380, 241, 388, 323, 153, 336, 207, 381, 230, 170, 394, 27, 34, 169, 
199, 309, 436, 410, 160, 427, 415, 24, 146, 469, 430, 190, 39, 140, 231, 267, 
197, 441, 105, 63, 401, 434, 257, 442, 470, 456, 68, 172, 285, 165, 212, 325, 
102, 338, 448, 473, 327, 3, 278, 218, 209, 127, 2, 337, 318, 26, 66, 223, 76, 
489, 365, 326, 64, 120, 147, 352, 92, 14, 292, 112, 467, 206, 440, 269, 249, 
404, 340, 65, 316, 454, 88, 175, 304, 472, 295, 200, 227, 141, 438, 100, 203, 
322, 47, 40, 56, 48, 411, 118, 59, 413, 61, 79, 103, 99, 29, 69, 86, 178, 12, 
217, 179, 94, 83, 32, 50, 240, 377, 74, 369, 270, 444, 399, 463, 266, 313, 250, 
10, 488, 264, 70, 482, 82, 167, 244, 431, 486, 298, 330, 17, 396, 460, 308, 426,
46, 254, 45, 25, 331, 261, 375, 53, 243, 41, 119, 481, 274, 468, 11, 202, 258, 
480, 215, 279, 213, 184, 205, 397, 121, 299, 385, 124, 297, 466, 148, 194, 378, 
133, 138, 129, 252, 154, 89, 450, 191, 364, 435, 238, 490, 67, 110, 155, 166, 
418, 405, 60, 228, 36, 307, 265, 458, 173, 8, 174, 286, 28, 204, 281, 333, 409, 
311, 272, 84, 294, 372, 168, 353, 453, 78, 236, 98, 158, 421, 193, 445, 446, 
162, 185, 406, 475, 97, 251, 189, 483, 478, 443, 461, 35, 287, 414, 58, 30, 382,
320, 123, 31, 348, 319, 57, 80, 416, 109, 247, 465, 183, 242, 351, 38, 439, 72, 
341, 359, 379, 363, 343, 312, 373, 462, 188, 6, 43, 7, 259, 132, 5, 386, 449, 
283, 371 ];
c := S!
\[ 1, 4, 6, 2, 10, 3, 13, 15, 9, 5, 21, 24, 7, 14, 8, 16, 31, 18, 35, 20, 11, 40,
23, 12, 44, 26, 47, 28, 52, 53, 17, 32, 56, 34, 19, 36, 61, 38, 39, 22, 41, 66, 
43, 25, 45, 70, 27, 48, 74, 76, 78, 29, 30, 80, 83, 33, 57, 85, 59, 89, 37, 62, 
63, 64, 65, 42, 67, 97, 98, 46, 100, 72, 104, 49, 75, 50, 110, 51, 113, 54, 115,
116, 55, 84, 58, 86, 120, 122, 60, 124, 91, 92, 93, 94, 95, 132, 68, 69, 133, 
71, 101, 136, 138, 73, 140, 106, 107, 144, 109, 77, 148, 150, 79, 114, 81, 82, 
154, 118, 119, 87, 121, 88, 161, 90, 125, 165, 127, 128, 129, 130, 131, 96, 99, 
134, 173, 102, 137, 103, 178, 105, 141, 142, 183, 108, 145, 186, 147, 111, 188, 
112, 190, 152, 153, 117, 155, 156, 157, 198, 159, 160, 123, 204, 206, 207, 126, 
166, 211, 168, 213, 170, 171, 172, 135, 174, 175, 176, 177, 139, 179, 180, 181, 
232, 143, 233, 235, 146, 187, 149, 238, 151, 191, 192, 193, 194, 246, 248, 197, 
158, 199, 253, 201, 255, 257, 162, 205, 163, 164, 261, 262, 264, 167, 228, 169, 
214, 215, 216, 217, 218, 219, 270, 221, 222, 223, 224, 225, 226, 227, 212, 229, 
230, 231, 182, 184, 282, 185, 285, 283, 189, 239, 240, 241, 242, 243, 297, 245, 
195, 301, 196, 249, 305, 307, 252, 200, 310, 202, 256, 203, 315, 259, 260, 208, 
209, 263, 210, 265, 266, 267, 323, 269, 220, 271, 272, 326, 274, 275, 276, 277, 
278, 279, 334, 281, 234, 237, 284, 236, 286, 338, 343, 289, 346, 291, 292, 293, 
294, 295, 296, 244, 355, 299, 357, 247, 333, 359, 304, 250, 361, 251, 308, 309, 
254, 366, 312, 313, 314, 258, 352, 317, 318, 319, 320, 321, 373, 268, 375, 325, 
273, 327, 328, 329, 330, 331, 383, 302, 280, 335, 388, 337, 287, 339, 340, 341, 
342, 288, 344, 397, 290, 347, 348, 349, 350, 351, 316, 353, 354, 298, 406, 300, 
384, 303, 360, 306, 387, 363, 364, 365, 311, 367, 368, 369, 404, 371, 372, 322, 
413, 324, 376, 417, 378, 379, 380, 420, 382, 332, 358, 385, 426, 362, 336, 389, 
390, 391, 392, 393, 394, 395, 432, 345, 398, 435, 400, 401, 402, 403, 370, 405, 
356, 407, 408, 409, 410, 411, 412, 374, 443, 445, 433, 377, 418, 447, 381, 421, 
422, 423, 451, 425, 386, 427, 428, 429, 430, 457, 396, 416, 459, 399, 460, 437, 
438, 439, 440, 441, 442, 414, 444, 415, 446, 419, 448, 449, 469, 424, 452, 453, 
454, 455, 456, 431, 458, 434, 436, 461, 462, 463, 464, 465, 466, 467, 468, 450, 
470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 
486, 490, 488, 489, 487, 491, 492, 493, 494, 495, 496 ];

    simp := sub<S|a,b>;
    simp`Order := 23499295948800;
    F, phi := FPGroupStrong(simp);

    soc := Socle(group);
    aut := Index(group, soc);
    if Print gt 1 then printf "group is O+(10,2):%o\n", aut; end if;
    ga, gb:= get_standard_gens_op102(soc);
    soc := sub< soc | ga,gb >;
    soc`Order := 23499295948800;
    newgens := [ group | ga, gb];
    for g in Generators(group) do
       if not g in sub<group|newgens> then Append(~newgens,g); end if;
    end for;
    group := sub<group|newgens>;
    aop102 := sub< S | a, b, c >;
    ims := [ aop102 | a, b];
    homom :=  hom< soc -> simp | ims >;
    for i in [Ngens(soc)+1..Ngens(group)] do
        g := group.i;
        CG := aop102; ce := Id(aop102);
        for j in [1..2] do
            isc, h := IsConjugate(CG,simp.j^ce,homom(soc.j^g));
            if not isc then error "Conjugation error in Aut(O+(10,2))"; end if;
            CG := Centraliser(CG,homom(soc.j^g));
            ce := ce*h;
        end for;
        Append(~ims,ce);
    end for;
    newgens := ims;
    for g in Generators(aop102) do
        if not g in sub<aop102|ims> then Append(~ims,g); end if;
    end for;
    aop102 := sub< S | ims >;
    homom :=  hom< group -> aop102 | newgens >;

    maximals:= [];
    if not max then 
        return homom, aop102, maximals, F, phi;
    end if;
    
    /* 
       Maximal subgroups from Birmingham web page.
       If their list is complete then all the subgroups below are
       maximal subgroups and give one from each conjugacy class
       of maximal subgroups.
    */ 

    /* maximals common to both auts first */

    // S(8,2)
    M := sub<simp | a, b*a*b*a*b^3 >;
    M`Order := 47377612800;
    Append(~maximals, M);

    // 2^8:O+(8,2)
    M := sub<simp | a, b^4*a*b^6*a*b^3>;
    M`Order := 44590694400;
    Append(~maximals, M);

    // (3xO-(8,2):2
    M := sub<simp|
	 b^-2 * a * b * a * b * a * b^-1 * a * b^-1 * a * b^-3, 
	 a * b^-3 * a * b^2 * a * b^4 * a * b^-2 * a >;
    M`Order := 1184440320;
    Append(~maximals, M);

    // 2^(1+12):(S3 x A8)
    M := sub<simp|
	a^b, 
	a * b * a * b * a * b^-1 * a * b^-1 * a, 
	b * a * b^6 * a * b^-2 * a >;
    M`Order := 990904320;
    Append(~maximals, M);

    // 2^(3+12):(S3 x S3 x L(3,2))
    M := sub<simp|
	a^b, 
	a * b * a * b^3 * a * b^2 * a * b^-2 * a * b^-3 * a * b^-1 * a, 
	a * b^-1 * a * b^4 * a * b^2 * a * b^-1 * a * b^2 * a * b * a * b^-1, 
	b * a * b^-1 * a * b^-5 * a * b^3 * a * b^2 * a * b * a * b^-1 >;
    M`Order := 198180864;
    Append(~maximals, M);

    // (A5 x U(4,2)):2
    M := sub<simp|
	b^-4 * a * b^-1 * a * b^-2 * a * b^2 * a * b * a * b^4, 
	a * b^2 * a * b^2 * a * b^-1 * a * b^-2 * a * b^2 * a * b^4, 
	a * b^-2 * a * b^-3 * a * b^-1 * a * b * a * b^3 * a * b * a * b * a >;
    M`Order := 3110400;
    Append(~maximals, M);

    // (S3 x S3 x A8):2
    M := sub<simp|
	b * a * b^5 * a * b^4 * a * b^-1 * a * b^-2, 
	a * b^2 * a * b * a * b^6 * a * b^3 * a * b^-5 * a * b^2 >;
    M`Order := 1451520;
    Append(~maximals, M);

    /* now the maximals that depend on what auts are about */

    if aut eq 1 then

	// 2^10:L(5,2) twice
	M := sub<simp| a, b^2*a*b^-3>;
	M`Order := 10239344640;
	Append(~maximals, M);
	Append(~maximals, M^c);

    else
	assert aut eq 2;

	// [2^15]:A8, intersection with simple is 2^(6+4+4):A8
	M := sub<simp|
	    b^-1 * a * b^-1 * a * b * a * b, 
	    b^-3 * a * b^3, b^-1 * a * b^4 * a * b * a * b^2 * a * b * 
		a * b^-1 * a >;
	M`Order := 330301440;
	Append(~maximals, M);

	// L(5,2):2, intersection with simple is L(5,2)
	M := sub<simp|a,
\[ 375, 451, 11, 101, 304, 159, 308, 55, 301, 40, 8, 440, 44, 470, 350, 168, 6, 
63, 295, 126, 157, 283, 256, 356, 355, 3, 222, 268, 407, 453, 365, 414, 273, 
174, 52, 9, 389, 191, 211, 410, 154, 351, 462, 455, 22, 303, 135, 309, 286, 247,
74, 381, 148, 151, 26, 464, 326, 457, 79, 270, 104, 207, 431, 156, 306, 184, 
482, 13, 199, 130, 376, 406, 349, 366, 92, 93, 285, 486, 293, 75, 165, 294, 46, 
317, 367, 476, 203, 445, 371, 80, 200, 312, 257, 428, 344, 439, 409, 19, 66, 
297, 160, 339, 242, 76, 81, 136, 333, 180, 59, 402, 353, 158, 27, 116, 241, 196,
307, 319, 194, 36, 401, 331, 99, 177, 214, 419, 232, 463, 16, 42, 447, 262, 360,
33, 41, 140, 57, 17, 56, 400, 468, 219, 404, 426, 133, 332, 385, 182, 425, 321, 
155, 103, 313, 193, 170, 398, 357, 164, 209, 377, 28, 147, 65, 338, 363, 488, 
218, 245, 302, 364, 408, 322, 396, 399, 474, 70, 441, 475, 383, 305, 329, 60, 
484, 478, 24, 483, 415, 110, 112, 253, 461, 281, 47, 188, 427, 166, 394, 20, 39,
443, 423, 102, 493, 373, 274, 300, 369, 296, 138, 380, 436, 393, 129, 7, 430, 
479, 109, 89, 382, 225, 125, 277, 374, 233, 420, 259, 251, 490, 150, 292, 91, 
289, 316, 446, 252, 186, 121, 107, 237, 108, 205, 359, 21, 113, 213, 132, 87, 
435, 362, 94, 187, 51, 128, 143, 272, 290, 61, 4, 261, 228, 234, 337, 390, 417, 
320, 487, 172, 206, 494, 53, 146, 230, 71, 348, 145, 29, 244, 190, 67, 224, 434,
124, 5, 43, 456, 96, 106, 485, 25, 72, 83, 318, 217, 481, 111, 34, 223, 459, 
327, 161, 491, 496, 323, 45, 358, 489, 413, 221, 137, 403, 438, 90, 276, 139, 
480, 361, 18, 255, 254, 411, 2, 149, 291, 328, 185, 48, 236, 372, 260, 49, 265, 
442, 85, 346, 424, 284, 416, 189, 335, 391, 342, 384, 343, 465, 310, 469, 336, 
115, 449, 437, 176, 392, 98, 432, 127, 433, 418, 240, 472, 450, 280, 388, 492, 
54, 412, 235, 238, 231, 264, 167, 370, 179, 142, 452, 212, 134, 258, 198, 201, 
495, 454, 204, 324, 88, 266, 314, 227, 178, 73, 64, 298, 311, 405, 175, 282, 
250, 340, 263, 208, 287, 448, 119, 30, 118, 1, 23, 153, 379, 220, 288, 122, 12, 
144, 82, 387, 246, 62, 243, 378, 97, 163, 141, 171, 202, 267, 117, 15, 173, 197,
471, 84, 95, 325, 216, 38, 69, 195, 473, 330, 31, 395, 466, 368, 460, 341, 226, 
169, 239, 37, 275, 229, 100, 345, 477, 458, 86, 210, 68, 397, 14, 248, 347, 278,
386, 354, 271, 444, 315, 78, 467, 183, 152, 352, 429, 249, 77, 35, 123, 192, 
422, 32, 269, 299, 215, 10, 334, 162, 114, 421, 181, 120, 105, 50, 279, 58, 131 
] >;
	M`Order := 9999360;
	Append(~maximals, M);

    end if;

    return homom, aop102, maximals, F, phi;

end function;
