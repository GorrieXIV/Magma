freeze;
 
get_standard_gens_3d42 := function(G)
/* standard gens from Birmingham web page */
/* assumes G is isomorphic to 3D4(2) */
    P := RandomProcess(G);
    repeat x := Random(P); until Order(x) eq 18; /* 1 in 6 */
    a := x ^ 9;
    b := x ^ 2;
    repeat
	b := b ^ Random(P);
	ab := a*b;
    until Order(ab) eq 13 and Order(ab*b) eq 8; /* 6 in 91 */
    return a,b;
end function;

tw3D42Identify := function(group:max:=true,Print:=0)
S := Sym(819);
a :=S!
\[ 1, 19, 33, 4, 5, 48, 59, 71, 69, 94, 106, 118, 128, 32, 53, 27, 163, 135, 2, 
151, 181, 199, 210, 77, 233, 129, 16, 73, 266, 274, 277, 14, 3, 296, 35, 149, 
183, 333, 343, 44, 360, 363, 347, 40, 159, 213, 373, 6, 318, 399, 405, 412, 15, 
421, 124, 112, 273, 272, 7, 76, 453, 458, 75, 72, 101, 340, 170, 237, 9, 414, 8,
64, 28, 518, 63, 60, 24, 160, 471, 480, 484, 492, 141, 565, 120, 323, 580, 587, 
330, 257, 180, 419, 178, 10, 422, 602, 432, 550, 406, 474, 65, 496, 212, 571, 
371, 11, 638, 381, 503, 290, 391, 56, 598, 482, 416, 161, 418, 12, 328, 85, 662,
500, 573, 55, 201, 394, 239, 13, 26, 630, 616, 280, 410, 282, 18, 179, 265, 369,
696, 542, 83, 267, 489, 242, 241, 365, 244, 258, 36, 379, 20, 314, 247, 248, 
249, 240, 182, 641, 45, 78, 116, 361, 17, 551, 508, 537, 457, 203, 264, 67, 349,
731, 316, 493, 621, 591, 509, 93, 136, 91, 21, 157, 37, 228, 730, 736, 722, 578,
577, 409, 207, 229, 702, 734, 614, 291, 669, 746, 22, 695, 125, 491, 168, 510, 
748, 539, 191, 285, 261, 23, 219, 103, 46, 691, 530, 766, 270, 221, 211, 532, 
218, 494, 437, 769, 436, 716, 384, 184, 192, 687, 276, 668, 25, 385, 777, 526, 
68, 305, 127, 156, 145, 144, 600, 147, 563, 545, 153, 154, 155, 427, 300, 713, 
292, 505, 788, 507, 90, 148, 279, 362, 209, 656, 562, 169, 137, 29, 142, 718, 
434, 217, 435, 58, 57, 30, 440, 231, 31, 633, 259, 132, 431, 134, 341, 603, 208,
636, 433, 459, 504, 110, 196, 253, 569, 735, 513, 34, 297, 779, 299, 251, 301, 
302, 303, 319, 238, 467, 595, 408, 710, 321, 790, 627, 355, 152, 445, 173, 461, 
49, 304, 561, 310, 745, 86, 763, 519, 741, 683, 119, 455, 89, 586, 585, 38, 588,
390, 596, 533, 617, 520, 66, 283, 375, 39, 699, 726, 728, 43, 374, 171, 613, 
498, 733, 486, 665, 313, 686, 708, 380, 809, 41, 162, 260, 42, 367, 146, 515, 
364, 462, 138, 681, 105, 707, 47, 348, 342, 640, 388, 387, 150, 358, 108, 742, 
639, 227, 234, 594, 378, 377, 729, 335, 111, 623, 747, 126, 396, 395, 438, 423, 
50, 413, 632, 817, 477, 607, 51, 99, 540, 308, 190, 133, 629, 52, 400, 70, 556, 
115, 676, 117, 92, 690, 54, 95, 398, 652, 774, 650, 250, 651, 649, 773, 281, 97,
287, 269, 271, 225, 223, 397, 522, 275, 524, 525, 527, 528, 315, 452, 447, 752, 
604, 813, 768, 446, 61, 755, 329, 581, 167, 62, 288, 723, 317, 368, 523, 499, 
501, 502, 306, 538, 622, 624, 79, 625, 479, 100, 789, 806, 403, 497, 473, 80, 
557, 114, 663, 81, 495, 353, 711, 555, 143, 634, 202, 82, 174, 222, 485, 102, 
478, 351, 464, 122, 465, 466, 109, 289, 254, 724, 256, 165, 177, 204, 572, 570, 
295, 642, 366, 644, 648, 74, 325, 339, 628, 439, 463, 441, 442, 236, 443, 444, 
804, 215, 608, 220, 337, 558, 635, 703, 166, 468, 206, 407, 737, 140, 548, 771, 
246, 694, 626, 543, 762, 98, 164, 698, 787, 619, 488, 415, 481, 534, 697, 744, 
320, 263, 245, 738, 84, 751, 601, 618, 293, 512, 104, 511, 123, 677, 791, 759, 
189, 188, 709, 87, 456, 740, 785, 720, 332, 331, 88, 334, 704, 606, 176, 597, 
721, 386, 307, 336, 592, 113, 795, 243, 567, 96, 284, 449, 818, 590, 404, 531, 
611, 661, 609, 685, 350, 195, 712, 131, 338, 568, 554, 620, 175, 469, 392, 470, 
472, 547, 312, 521, 411, 130, 808, 401, 278, 490, 535, 286, 784, 107, 383, 376, 
158, 514, 743, 516, 776, 807, 693, 517, 429, 426, 428, 424, 672, 781, 679, 262, 
725, 664, 812, 714, 610, 121, 483, 658, 354, 792, 684, 232, 197, 760, 689, 653, 
750, 674, 782, 417, 574, 780, 655, 754, 370, 765, 327, 667, 612, 356, 230, 705, 
671, 420, 214, 719, 647, 546, 200, 139, 559, 552, 344, 786, 757, 193, 536, 589, 
688, 797, 372, 357, 579, 309, 487, 615, 252, 660, 810, 226, 753, 268, 692, 584, 
593, 187, 460, 506, 657, 345, 811, 346, 389, 185, 172, 756, 352, 194, 294, 186, 
541, 564, 796, 582, 326, 382, 643, 560, 322, 198, 393, 205, 772, 673, 566, 448, 
717, 680, 454, 732, 701, 815, 576, 670, 793, 549, 324, 767, 682, 216, 764, 451, 
224, 775, 544, 749, 430, 425, 770, 645, 235, 814, 298, 678, 654, 675, 783, 637, 
583, 700, 553, 255, 475, 311, 575, 666, 761, 799, 599, 739, 706, 798, 794, 800, 
801, 819, 803, 529, 805, 476, 646, 631, 359, 715, 727, 659, 450, 778, 758, 816, 
402, 605, 802 ];
b:= S!
\[ 230, 384, 511, 502, 169, 789, 123, 22, 313, 227, 450, 56, 371, 569, 349, 304, 
719, 582, 221, 314, 218, 529, 401, 755, 174, 115, 295, 350, 239, 108, 82, 326, 
97, 193, 345, 690, 75, 278, 482, 658, 330, 128, 695, 757, 204, 673, 297, 554, 
625, 758, 635, 756, 659, 717, 526, 812, 275, 273, 541, 810, 567, 307, 377, 675, 
618, 730, 547, 70, 202, 494, 365, 232, 473, 488, 448, 612, 657, 280, 633, 492, 
439, 155, 596, 441, 591, 427, 747, 354, 808, 253, 418, 662, 390, 163, 413, 397, 
552, 610, 741, 293, 534, 9, 373, 564, 374, 116, 165, 788, 459, 302, 725, 157, 
360, 811, 656, 801, 48, 456, 102, 665, 85, 622, 25, 682, 60, 480, 678, 282, 49, 
16, 289, 87, 238, 143, 105, 722, 677, 160, 471, 346, 340, 779, 696, 759, 732, 
337, 753, 270, 475, 777, 362, 20, 797, 398, 516, 597, 501, 704, 400, 540, 606, 
483, 409, 727, 333, 206, 203, 267, 614, 294, 469, 680, 67, 44, 667, 149, 272, 
100, 589, 718, 17, 499, 573, 815, 660, 101, 721, 775, 495, 28, 78, 27, 527, 655, 
363, 164, 549, 710, 410, 555, 642, 181, 510, 50, 260, 653, 151, 641, 26, 654, 
393, 794, 141, 41, 324, 514, 776, 792, 632, 813, 617, 318, 357, 133, 763, 676, 
752, 375, 651, 292, 672, 180, 681, 634, 228, 491, 674, 548, 196, 679, 308, 472, 
428, 602, 687, 506, 738, 493, 585, 186, 422, 391, 512, 309, 110, 816, 744, 803, 
737, 103, 605, 505, 79, 566, 104, 731, 279, 379, 8, 807, 419, 531, 317, 805, 707,
338, 553, 454, 63, 720, 804, 199, 299, 5, 746, 29, 603, 453, 387, 749, 550, 728, 
286, 376, 36, 214, 217, 683, 254, 65, 772, 18, 381, 246, 761, 703, 760, 740, 623,
6, 93, 236, 537, 316, 15, 132, 463, 53, 487, 525, 440, 462, 167, 629, 135, 383, 
509, 33, 118, 220, 61, 661, 305, 698, 389, 90, 705, 712, 609, 140, 616, 565, 58, 
481, 809, 125, 518, 40, 205, 595, 615, 7, 385, 14, 478, 412, 498, 283, 129, 745, 
818, 467, 535, 700, 94, 464, 702, 341, 173, 406, 765, 664, 258, 736, 329, 242, 
640, 648, 231, 257, 249, 594, 99, 508, 544, 190, 285, 751, 189, 311, 153, 484, 
182, 358, 112, 327, 209, 68, 579, 120, 321, 630, 185, 138, 136, 45, 296, 134, 
771, 328, 175, 2, 646, 560, 117, 187, 608, 461, 697, 694, 91, 142, 343, 77, 66, 
572, 421, 372, 407, 670, 431, 11, 415, 693, 701, 417, 250, 331, 726, 47, 517, 
399, 80, 806, 576, 351, 271, 69, 451, 216, 290, 183, 229, 3, 580, 452, 477, 312, 
621, 71, 380, 245, 411, 274, 627, 686, 287, 644, 152, 619, 119, 76, 684, 159, 
652, 476, 486, 692, 107, 244, 139, 639, 636, 89, 599, 57, 485, 288, 536, 405, 
161, 650, 54, 519, 739, 194, 436, 310, 208, 429, 578, 734, 168, 109, 688, 530, 
468, 631, 561, 382, 592, 445, 88, 369, 156, 325, 38, 613, 301, 224, 748, 620, 
562, 30, 504, 470, 523, 539, 520, 162, 378, 21, 785, 243, 122, 263, 344, 368, 
666, 769, 711, 64, 366, 335, 545, 600, 432, 269, 210, 586, 689, 42, 35, 121, 403,
24, 433, 319, 435, 137, 284, 568, 1, 588, 55, 111, 233, 166, 714, 800, 219, 241, 
235, 396, 438, 81, 212, 601, 98, 781, 647, 528, 773, 322, 261, 817, 767, 126, 
201, 668, 557, 84, 442, 225, 39, 563, 392, 754, 408, 352, 276, 743, 300, 783, 
147, 425, 172, 430, 764, 570, 176, 628, 188, 574, 793, 742, 669, 207, 424, 148, 
577, 607, 434, 420, 248, 43, 348, 649, 402, 733, 10, 197, 247, 474, 460, 130, 
542, 388, 778, 533, 262, 127, 364, 416, 457, 497, 106, 532, 170, 347, 799, 268, 
34, 334, 179, 798, 342, 252, 584, 355, 72, 645, 62, 437, 226, 750, 423, 96, 729, 
95, 770, 611, 426, 131, 264, 234, 543, 496, 13, 735, 52, 489, 83, 370, 59, 814, 
222, 211, 192, 713, 213, 790, 394, 513, 479, 558, 4, 571, 587, 184, 223, 685, 
802, 259, 706, 240, 92, 23, 637, 455, 306, 395, 796, 624, 786, 361, 774, 113, 
762, 522, 556, 643, 446, 780, 709, 336, 178, 298, 638, 458, 46, 447, 339, 145, 
195, 31, 724, 124, 784, 266, 671, 598, 265, 86, 332, 583, 171, 404, 723, 255, 
795, 356, 782, 604, 507, 575, 546, 73, 515, 277, 626, 37, 819, 215, 146, 154, 
291, 158, 281, 715, 51, 766, 237, 359, 443, 708, 716, 386, 581, 256, 524, 303, 
538, 353, 503, 32, 466, 198, 559, 200, 593, 177, 449, 320, 19, 551, 465, 590, 
114, 791, 251, 367, 315, 521, 414, 699, 191, 144, 663, 691, 74, 12, 500, 150, 
490, 768, 444, 787, 323 ];
c := S!
\[ 2, 7, 21, 34, 36, 37, 1, 61, 73, 84, 96, 108, 120, 129, 139, 148, 158, 94, 170,
46, 182, 192, 201, 212, 224, 235, 245, 251, 259, 156, 146, 26, 283, 287, 19, 268,
311, 322, 291, 344, 351, 339, 366, 370, 324, 378, 382, 274, 190, 106, 401, 209, 
114, 417, 15, 430, 149, 326, 302, 338, 446, 455, 56, 206, 372, 474, 157, 486, 52,
495, 498, 347, 503, 500, 316, 521, 529, 299, 537, 544, 438, 553, 409, 304, 551, 
566, 571, 214, 216, 86, 256, 194, 596, 598, 403, 136, 342, 195, 612, 528, 484, 
346, 269, 252, 425, 524, 466, 584, 406, 113, 155, 473, 135, 124, 448, 402, 654, 
293, 273, 656, 658, 557, 567, 53, 353, 670, 211, 549, 577, 506, 471, 678, 684, 
343, 110, 11, 243, 166, 55, 62, 22, 40, 700, 89, 704, 621, 706, 396, 380, 320, 
80, 165, 431, 701, 665, 715, 626, 718, 488, 361, 79, 147, 416, 83, 355, 414, 428,
261, 436, 35, 435, 511, 350, 523, 659, 642, 682, 440, 601, 729, 303, 3, 737, 738,
740, 644, 730, 507, 693, 494, 199, 141, 607, 284, 580, 358, 688, 429, 260, 309, 
463, 717, 420, 620, 118, 290, 692, 579, 69, 763, 374, 333, 384, 604, 630, 144, 
266, 539, 485, 122, 75, 257, 532, 767, 450, 76, 713, 751, 104, 238, 308, 160, 
451, 660, 32, 783, 327, 454, 100, 48, 728, 517, 677, 426, 510, 616, 328, 222, 
487, 535, 468, 229, 210, 422, 348, 412, 248, 218, 407, 191, 617, 70, 724, 225, 
600, 761, 188, 5, 357, 775, 633, 101, 296, 240, 594, 687, 365, 255, 204, 184, 
189, 794, 547, 92, 81, 754, 4, 371, 663, 64, 618, 418, 205, 444, 674, 119, 773, 
622, 635, 481, 181, 341, 301, 10, 42, 627, 726, 364, 628, 469, 6, 87, 126, 765, 
804, 221, 472, 143, 563, 727, 373, 591, 60, 657, 652, 750, 792, 345, 223, 802, 
638, 159, 24, 388, 555, 442, 317, 323, 305, 288, 59, 543, 526, 142, 247, 807, 
649, 278, 125, 810, 809, 603, 349, 476, 152, 325, 103, 812, 671, 185, 232, 723, 
400, 231, 595, 424, 564, 131, 363, 575, 340, 798, 593, 127, 300, 755, 685, 20, 
377, 57, 82, 778, 386, 456, 331, 467, 694, 698, 762, 271, 758, 85, 565, 459, 805,
16, 568, 748, 275, 369, 550, 404, 703, 116, 683, 610, 29, 808, 164, 202, 816, 91,
662, 138, 513, 433, 645, 811, 490, 508, 548, 709, 631, 43, 745, 613, 198, 608, 
427, 63, 799, 405, 163, 460, 721, 505, 614, 285, 790, 509, 561, 573, 77, 742, 
228, 8, 711, 705, 791, 264, 574, 93, 133, 230, 140, 213, 669, 560, 587, 586, 605,
779, 23, 112, 393, 559, 383, 28, 787, 554, 368, 337, 464, 552, 227, 801, 643, 
352, 295, 449, 375, 286, 389, 272, 757, 569, 764, 332, 130, 639, 458, 362, 632, 
49, 262, 583, 234, 690, 183, 597, 680, 695, 9, 759, 169, 489, 267, 203, 178, 27, 
753, 413, 519, 520, 696, 207, 707, 585, 415, 697, 226, 540, 689, 50, 776, 134, 
542, 239, 443, 619, 411, 329, 193, 525, 747, 651, 161, 599, 258, 636, 319, 702, 
97, 151, 387, 606, 33, 739, 625, 51, 392, 66, 381, 732, 744, 501, 220, 731, 107, 
491, 817, 538, 541, 666, 465, 90, 782, 777, 68, 699, 312, 461, 336, 233, 44, 408,
14, 634, 641, 98, 578, 117, 815, 12, 733, 434, 394, 306, 769, 132, 38, 215, 321, 
399, 277, 452, 74, 18, 562, 785, 786, 315, 478, 88, 572, 796, 533, 167, 187, 109,
708, 710, 244, 774, 236, 781, 168, 39, 749, 279, 31, 789, 493, 675, 128, 67, 588,
200, 282, 592, 818, 623, 390, 581, 78, 522, 307, 385, 419, 462, 208, 681, 648, 
722, 54, 391, 752, 477, 72, 270, 712, 356, 180, 582, 447, 13, 45, 788, 743, 497, 
676, 512, 734, 667, 111, 367, 736, 439, 819, 313, 672, 359, 647, 479, 814, 735, 
137, 590, 145, 556, 176, 714, 432, 453, 379, 297, 716, 813, 174, 71, 398, 516, 
281, 545, 725, 770, 514, 334, 795, 318, 760, 527, 95, 679, 115, 162, 242, 780, 
254, 99, 655, 536, 475, 177, 30, 276, 410, 17, 263, 314, 171, 186, 492, 719, 502,
637, 150, 806, 653, 609, 771, 470, 518, 289, 661, 664, 499, 280, 421, 360, 766, 
294, 175, 335, 105, 797, 250, 691, 530, 58, 445, 673, 172, 482, 756, 376, 219, 
646, 772, 154, 217, 483, 253, 249, 720, 800, 25, 589, 768, 515, 558, 504, 686, 
437, 650, 534, 397, 47, 640, 611, 246, 123, 615, 330, 265, 179, 310, 121, 298, 
668, 480, 237, 395, 629, 570, 546, 803, 65, 153, 741, 354, 784, 746, 602, 793, 
241, 102, 576, 41, 173, 292, 196, 197, 624, 496, 531, 441, 423, 457 ];

    simp := sub<S|a,b>;
    simp`Order := 211341312;
    F, phi := FPGroupStrong(simp);
    soc := Socle(group);
    aut := Index(group, soc);
    if Print gt 1 then printf "group is 3D4(2):[%o]\n", aut; end if;
    ga, gb:= get_standard_gens_3d42(soc);
    soc := sub< soc | ga,gb >;
    soc`Order := 211341312;
    newgens := [ group | ga, gb];
    for g in Generators(group) do
       if not g in sub<group|newgens> then Append(~newgens,g); end if;
    end for;
    group := sub<group|newgens>;
    a3d42 := sub< S | a, b, c >;
    ims := [ a3d42 | a, b];
    homom :=  hom< soc -> simp | ims >;
    for i in [Ngens(soc)+1..Ngens(group)] do
        g := group.i;
        CG := a3d42; ce := Id(a3d42);
        for j in [1..2] do
            isc, h := IsConjugate(CG,simp.j^ce,homom(soc.j^g));
            if not isc then error "Conjugation error in Aut(3D4(2))"; end if;
            CG := Centraliser(CG,homom(soc.j^g));
            ce := ce*h;
        end for;
        Append(~ims,ce);
    end for;
    newgens := ims;
    for g in Generators(a3d42) do
        if not g in sub<a3d42|ims> then Append(~ims,g); end if;
    end for;
    a3d42 := sub< S | ims >;
    homom :=  hom< group -> a3d42 | newgens >;

    maximals:= [];
    if not max then 
        return homom, a3d42, maximals, F, phi;
    end if;
    
    /* 
       Maximal subgroups from Birmingham web page.
       If their list is complete then all the subgroups below are
       maximal subgroups and give one from each conjugacy class
       of maximal subgroups.
    */ 

    // 2^(1+8):L(2,8) [point stabilizer]
    M := sub<simp|
	b * a * b^-1 * a * b, 
	b^-2 * a * b^2 * a * b^-2 >;
    M`Order := 258048;
    Append(~maximals, M); 

    // [2^11]:(7 x S3) 
    M := sub<simp|
	b * a * b^-1 * a * b, 
	b^-1 * a * b^-1 * a * b^-1 * a * b * a * b * a * b >;
    M`Order := 86016;
    Append(~maximals, M); 

    // U(3,3):2
    M := sub<simp|
	a * b^-1 * a * b^-1 * a * b^-3 * a * b^-1 * a * b^-2 * a, 
	b^-1 * a * b * a * b^-2 * a * b^-3 * a * b^-2 * a * b * a * b >;
    M`Order := 12096;
    Append(~maximals, M); 
    
    // S3 x L(2,8)
    M := sub<simp|
	a * b^3 * a * b^-3, 
	a * b^-1 * a * b^-1 * a * b^-2 * a * b^-2 * a * b^2>;
    M`Order := 3024;
    Append(~maximals, M); 

    // (7 x L(2,7)):2 
    M := sub<simp|
	a * b^-2 * a * b^2 * a, 
	b^-1 * a * b^-1 * a * b^-2 * a * b * a * b^-2 * a * b^-2, 
	a * b^4 * a * b^3 * a * b^4 * a * b^2 >;
    M`Order := 2352;
    Append(~maximals, M); 

    // 3^(1+2):2S4
    M := sub<simp|
	b^3 * a * b^2 * a * b^-3 * a * b^2 * a * b^3 * a, 
	a * b^2 * a * b^4 * a * b^2 * a * b^2 * a * b^-2 * a * b^-1 >;
    M`Order := 1296;
    Append(~maximals, M); 

    // 7^2:2A4
    M := sub<simp|
      b^-1 * a * b^-2 * a * b^-1 * a * b^-1 * a * b * a * b * a * b * a * b^2,
      b * a * b^2 * a * b^-1 * a * b^-1 * a * b * a * b * a * b^-3 * a * b^-2 >;
    M`Order := 1176;
    Append(~maximals, M);

    // 3^2:2A4
    M := sub<simp|
	b^-2 * a * b^-1 * a * b^-3 * a * b^-1 * a * b^2 * a * b^3 * a * b * a, 
	a * b^-1 * a * b^3 * a * b^-4 * a * b * a * b * a * b^2 * a * b^-2 >;
    M`Order := 216;
    Append(~maximals, M);

    // 13:4
    M := sub<simp|
	b * a * b * a * b^-2 * a * b^-4 * a * b * a * b^-2 * a * b^-1 * a * 
	    b^-1 * a * b^-1 * a * b^-1, 
	b^-1 * a * b^2 * a * b^-1 * a * b^-4 * a * b * a * b^2 * a * b * a * 
	    b^2 * a * b * a >;
    M`Order := 52;
    Append(~maximals, M);

    return homom, a3d42, maximals, F, phi;
end function;
