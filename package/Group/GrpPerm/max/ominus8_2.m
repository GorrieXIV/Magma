freeze;
 
//function names
//FindGoodGens(group)
//OMinus8_2Maximals(group)

GetGroups := function()
omega:= PermutationGroup<119 |  
    \[ 78, 89, 55, 24, 39, 34, 38, 100, 99, 77, 62, 74, 69, 111, 48, 54,
    57, 70, 67, 63, 46, 81, 75, 4, 61, 64, 117, 29, 28, 44, 104, 85, 41,
    6, 93, 50, 86, 7, 5, 98, 33, 110, 105, 30, 96, 21, 109, 15, 91, 36, 
    92, 52, 53, 16, 3, 95, 17, 68, 80, 60, 25, 11, 20, 26, 73, 114, 19, 
    58, 13, 18, 76, 113, 65, 12, 23, 71, 10, 1, 79, 59, 22, 82, 118, 
    103, 32, 37, 107, 88, 2, 112, 49, 51, 35, 106, 56, 45, 101, 40, 9, 
    8, 97, 108, 84, 31, 43, 94, 87, 102, 47, 42, 14, 90, 72, 66, 119, 
    116, 27, 83, 115 ],
    \[ 105, 67, 43, 16, 21, 59, 87, 35, 106, 24, 25, 73, 12, 32, 118, 
    61, 104, 111, 40, 26, 96, 15, 42, 119, 38, 76, 14, 1, 79, 80, 68, 
    27, 99, 34, 109, 36, 52, 11, 72, 51, 30, 54, 102, 50, 6, 81, 29, 31,
    18, 83, 19, 55, 89, 23, 37, 17, 2, 9, 45, 69, 4, 65, 77, 98, 108, 
    97, 57, 48, 75, 101, 39, 71, 13, 92, 60, 20, 112, 110, 47, 41, 88, 
    64, 44, 33, 74, 93, 100, 46, 90, 53, 86, 85, 91, 66, 116, 5, 94, 82,
    84, 7, 107, 3, 113, 56, 28, 58, 70, 62, 8, 117, 49, 63, 114, 103, 
    95, 115, 78, 22, 10 ] >;

invol := Sym(119)!
(2, 27)(7, 35)(9, 102)(13, 68)(14, 88)(15, 78)(16, 119)(17, 116)(20, 58)(23, 
    52)(24, 83)(28, 48)(31, 70)(32, 60)(36, 112)(39, 66)(41, 117)(42, 49)(45, 
    54)(50, 97)(56, 108)(61, 93)(71, 91)(74, 104)(80, 103)(84, 106)(100, 
    118)(109, 114);

isotrop_point:= PermutationGroup<119 |  
    \[ 1, 22, 78, 113, 20, 118, 57, 9, 5, 23, 79, 18, 106, 51, 101, 63, 40, 
    115, 11, 72, 74, 86, 112, 55, 88, 67, 49, 54, 64, 68, 53, 13, 97, 45, 39, 
    38, 65, 96, 77, 90, 16, 47, 93, 36, 104, 91, 2, 34, 17, 109, 25, 110, 28, 
    82, 62, 60, 24, 102, 85, 4, 15, 33, 92, 108, 107, 103, 69, 89, 7, 31, 41, 
    87, 73, 48, 81, 114, 95, 71, 19, 26, 117, 70, 35, 30, 43, 8, 94, 27, 29, 
    116, 59, 119, 6, 42, 66, 98, 111, 84, 75, 61, 3, 14, 50, 21, 76, 52, 37, 
    44, 105, 10, 80, 56, 32, 83, 12, 58, 46, 99, 100 ],
    \[ 1, 25, 18, 68, 61, 78, 105, 115, 47, 13, 93, 15, 64, 59, 85, 72, 87, 42,
    17, 58, 96, 94, 52, 109, 117, 62, 99, 39, 45, 67, 53, 7, 112, 26, 98, 97, 
    74, 55, 21, 81, 86, 100, 14, 89, 108, 49, 116, 23, 20, 114, 41, 66, 54, 35,
    36, 50, 104, 118, 88, 56, 91, 111, 102, 30, 44, 37, 113, 77, 10, 65, 2, 
    119, 95, 4, 19, 76, 48, 5, 63, 73, 79, 80, 32, 107, 101, 12, 40, 90, 31, 
    11, 71, 9, 27, 16, 28, 103, 60, 70, 43, 22, 8, 75, 82, 69, 29, 34, 83, 84, 
    33, 38, 24, 106, 57, 110, 51, 46, 6, 92, 3 ]
        /* order = 1658880 = 2^12 * 3^4 * 5 */ >;
nonisotrop_point:= PermutationGroup<119 |  
    \[ 25, 15, 56, 42, 109, 89, 28, 11, 45, 41, 23, 76, 50, 116, 92, 20, 1, 68,
    37, 52, 98, 17, 8, 60, 47, 14, 30, 112, 51, 27, 110, 117, 65, 97, 12, 26, 
    32, 59, 88, 96, 3, 87, 95, 99, 55, 83, 34, 63, 114, 66, 85, 80, 81, 49, 82,
    10, 39, 6, 38, 113, 24, 57, 43, 118, 119, 67, 48, 72, 19, 100, 101, 53, 79,
    22, 106, 104, 75, 108, 78, 16, 90, 9, 46, 69, 105, 54, 111, 62, 103, 31, 
    13, 40, 94, 73, 5, 61, 86, 36, 58, 4, 64, 18, 44, 35, 29, 2, 107, 93, 115, 
    7, 21, 102, 77, 74, 91, 70, 84, 71, 33 ],
    \[ 34, 35, 50, 99, 100, 66, 102, 15, 24, 104, 44, 8, 115, 119, 103, 39, 
    118, 86, 110, 78, 106, 30, 3, 48, 83, 12, 94, 46, 69, 32, 27, 1, 58, 31, 
    33, 42, 18, 55, 54, 10, 113, 61, 41, 36, 63, 80, 16, 70, 64, 59, 47, 112, 
    88, 84, 111, 107, 108, 82, 21, 60, 40, 73, 96, 49, 77, 75, 76, 52, 28, 95, 
    19, 79, 57, 37, 98, 13, 65, 25, 90, 20, 114, 2, 85, 74, 29, 51, 5, 53, 43, 
    93, 109, 91, 97, 7, 9, 67, 68, 23, 87, 4, 72, 22, 26, 14, 101, 6, 92, 17, 
    56, 62, 45, 105, 116, 81, 38, 89, 71, 117, 11 ]
        /* order = 1451520 = 2^9 * 3^4 * 5 * 7 */ >;
isotrop_plane:= PermutationGroup<119 |  
    \[ 90, 119, 1, 93, 75, 95, 115, 11, 84, 102, 5, 38, 72, 14, 56, 27, 54, 51,
    34, 39, 71, 57, 101, 40, 63, 58, 100, 47, 13, 17, 4, 55, 61, 35, 99, 82, 
    83, 104, 105, 110, 106, 112, 89, 48, 21, 81, 37, 94, 32, 43, 8, 85, 24, 
    113, 9, 65, 68, 80, 76, 107, 36, 116, 86, 78, 91, 62, 28, 19, 97, 96, 66, 
    73, 7, 79, 18, 74, 114, 45, 29, 64, 25, 117, 87, 33, 67, 92, 69, 2, 23, 3, 
    103, 46, 60, 53, 52, 49, 6, 109, 77, 16, 44, 31, 30, 22, 15, 111, 41, 26, 
    59, 50, 42, 10, 20, 12, 98, 108, 70, 118, 88 ],
    \[ 3, 1, 88, 58, 30, 46, 94, 68, 25, 40, 52, 16, 78, 33, 8, 96, 75, 83, 27,
    100, 116, 86, 101, 41, 55, 79, 28, 110, 49, 66, 12, 57, 44, 36, 80, 56, 54,
    37, 95, 62, 74, 13, 26, 91, 47, 105, 51, 71, 63, 59, 35, 112, 22, 39, 60, 
    38, 34, 4, 50, 17, 5, 43, 104, 93, 98, 9, 67, 29, 84, 70, 111, 48, 87, 42, 
    113, 117, 103, 24, 10, 85, 114, 53, 89, 69, 11, 65, 92, 2, 15, 118, 14, 82,
    109, 21, 77, 31, 106, 6, 81, 97, 64, 7, 32, 76, 73, 20, 102, 61, 115, 19, 
    72, 99, 108, 45, 107, 23, 18, 90, 119 ]
        /* order = 258048 = 2^12 * 3^2 * 7 */ >;
isotrop_line:= PermutationGroup<119 |  
    \[ 2, 1, 20, 75, 80, 90, 46, 53, 22, 116, 64, 117, 72, 48, 6, 4, 61, 74, 
    85, 87, 59, 49, 78, 92, 98, 16, 31, 39, 71, 95, 115, 68, 38, 82, 32, 36, 
    37, 34, 103, 108, 62, 44, 50, 11, 27, 73, 88, 86, 119, 42, 24, 30, 51, 69, 
    35, 33, 28, 109, 89, 101, 3, 5, 107, 102, 96, 8, 77, 97, 105, 104, 26, 60, 
    43, 41, 13, 81, 70, 23, 76, 94, 112, 57, 56, 54, 15, 21, 99, 12, 40, 19, 9,
    45, 106, 111, 65, 52, 55, 100, 47, 110, 29, 7, 83, 113, 114, 18, 25, 58, 
    14, 79, 93, 63, 84, 67, 66, 10, 17, 118, 91 ],
    \[ 118, 1, 47, 115, 55, 12, 8, 56, 15, 42, 104, 9, 25, 34, 90, 103, 119, 
    105, 85, 87, 92, 88, 93, 100, 95, 101, 97, 108, 78, 10, 75, 4, 29, 112, 23,
    66, 76, 62, 7, 114, 54, 67, 82, 71, 63, 52, 20, 79, 91, 5, 70, 73, 94, 109,
    80, 98, 45, 36, 35, 14, 19, 81, 69, 59, 64, 18, 106, 74, 107, 24, 37, 30, 
    41, 72, 68, 11, 26, 28, 39, 102, 57, 50, 111, 44, 99, 65, 17, 49, 16, 61, 
    117, 32, 84, 83, 48, 21, 13, 51, 3, 96, 113, 77, 53, 31, 110, 58, 27, 116, 
    40, 86, 46, 43, 89, 60, 38, 33, 22, 2, 6 ]
        /* order = 184320 = 2^12 * 3^2 * 5 */ >;
nonisotrop_line:= PermutationGroup<119 |  
    \[ 21, 95, 33, 60, 39, 105, 73, 26, 109, 117, 42, 11, 98, 69, 114, 101, 16,
    56, 82, 99, 75, 112, 28, 118, 15, 10, 53, 88, 90, 107, 24, 72, 71, 103, 38,
    85, 51, 45, 35, 102, 27, 77, 55, 61, 110, 78, 81, 100, 29, 48, 108, 50, 
    111, 67, 70, 89, 65, 79, 86, 12, 47, 25, 49, 62, 64, 74, 54, 57, 80, 52, 
    34, 30, 17, 94, 5, 93, 4, 13, 106, 83, 3, 91, 14, 7, 36, 96, 58, 44, 113, 
    63, 76, 66, 43, 92, 1, 31, 97, 46, 20, 19, 84, 68, 23, 6, 8, 104, 32, 37, 
    115, 116, 41, 40, 18, 22, 9, 2, 119, 59, 87 ],
    \[ 91, 93, 62, 119, 72, 69, 55, 70, 26, 80, 82, 75, 27, 12, 44, 2, 50, 103,
    42, 1, 6, 34, 96, 18, 102, 53, 7, 64, 39, 101, 88, 58, 113, 24, 99, 30, 21,
    85, 115, 89, 14, 92, 66, 114, 17, 16, 28, 94, 76, 95, 104, 87, 100, 52, 79,
    40, 22, 37, 118, 13, 23, 31, 77, 15, 56, 107, 90, 112, 45, 32, 68, 19, 11, 
    51, 78, 84, 48, 5, 106, 117, 33, 67, 73, 8, 105, 25, 54, 65, 57, 108, 20, 
    46, 116, 10, 49, 81, 3, 63, 83, 29, 109, 59, 97, 110, 38, 98, 9, 4, 35, 43,
    74, 47, 71, 61, 111, 41, 60, 86, 36 ]
        /* order = 120960 = 2^7 * 3^3 * 5 * 7 */ >;
superfield:= PermutationGroup<119 |  
    \[ 62, 67, 6, 106, 61, 78, 49, 35, 16, 59, 38, 29, 40, 77, 73, 72, 
    87, 101, 12, 96, 26, 65, 4, 76, 25, 98, 81, 39, 41, 54, 58, 75, 109,
    11, 48, 57, 111, 34, 21, 108, 102, 80, 71, 117, 20, 112, 70, 100, 
    119, 42, 7, 47, 89, 23, 5, 17, 14, 94, 110, 69, 74, 83, 2, 84, 44, 
    22, 88, 30, 60, 52, 95, 99, 43, 118, 36, 105, 32, 3, 55, 10, 27, 
    115, 1, 116, 15, 93, 31, 46, 90, 53, 18, 33, 9, 56, 85, 45, 28, 97, 
    86, 113, 91, 103, 19, 66, 114, 68, 8, 13, 92, 50, 24, 63, 107, 37, 
    51, 64, 104, 79, 82 ],
    \[ 37, 95, 46, 99, 50, 11, 117, 107, 32, 105, 71, 29, 20, 64, 16, 
    43, 60, 13, 75, 98, 114, 100, 47, 115, 97, 48, 22, 1, 116, 54, 111, 
    2, 3, 77, 56, 106, 31, 92, 18, 42, 52, 26, 85, 113, 61, 102, 73, 82,
    25, 62, 91, 67, 74, 84, 69, 27, 14, 101, 65, 83, 76, 28, 68, 109, 
    39, 21, 38, 103, 8, 86, 4, 19, 33, 58, 30, 59, 70, 23, 49, 87, 79, 
    89, 53, 34, 36, 6, 118, 63, 17, 44, 81, 9, 72, 96, 88, 51, 5, 104, 
    112, 55, 7, 15, 57, 80, 66, 12, 10, 24, 41, 40, 94, 93, 45, 108, 35,
    78, 119, 90, 110 ]
        /* order = 8160 = 2^5 * 3 * 5 * 17 */ >;
nonisotrop_four:= PermutationGroup<119 |  
    \[ 1, 81, 9, 39, 40, 12, 113, 118, 6, 83, 5, 3, 37, 42, 15, 93, 17, 
    46, 90, 75, 98, 41, 48, 89, 71, 23, 18, 60, 64, 10, 31, 68, 56, 34, 
    96, 67, 76, 35, 109, 100, 22, 115, 88, 30, 84, 101, 19, 106, 43, 21,
    16, 13, 29, 32, 104, 33, 107, 92, 20, 28, 94, 62, 14, 80, 73, 50, 
    55, 69, 54, 112, 25, 91, 77, 70, 85, 52, 108, 61, 51, 53, 2, 38, 44,
    111, 59, 87, 72, 116, 24, 117, 86, 58, 79, 119, 74, 82, 4, 66, 102, 
    11, 27, 99, 110, 36, 45, 26, 57, 65, 97, 103, 105, 95, 7, 114, 63, 
    49, 47, 8, 78 ],
    \[ 62, 113, 9, 42, 93, 15, 114, 7, 6, 5, 46, 3, 40, 101, 12, 38, 29,
    82, 64, 86, 44, 94, 4, 60, 56, 13, 104, 89, 88, 21, 20, 75, 57, 43, 
    105, 84, 66, 28, 24, 25, 108, 79, 74, 92, 115, 36, 31, 45, 102, 10, 
    96, 23, 22, 41, 97, 30, 26, 27, 110, 100, 103, 118, 18, 85, 117, 
    111, 52, 116, 59, 47, 35, 99, 54, 69, 73, 63, 17, 61, 55, 49, 2, 37,
    98, 50, 72, 87, 77, 78, 109, 80, 65, 71, 67, 119, 90, 83, 48, 76, 
    95, 16, 33, 91, 19, 39, 106, 107, 58, 68, 14, 32, 11, 34, 1, 8, 51, 
    112, 53, 81, 70 ]
        /* order = 4320 = 2^5 * 3^3 * 5 */ >;
l2_7:= PermutationGroup<119 |  
    \[ 8, 34, 86, 87, 45, 41, 61, 1, 94, 22, 112, 78, 93, 69, 47, 73, 
    72, 54, 117, 35, 50, 10, 113, 64, 60, 83, 67, 65, 98, 48, 103, 63, 
    101, 2, 20, 46, 95, 88, 106, 107, 6, 104, 116, 119, 5, 36, 15, 30, 
    114, 21, 108, 105, 53, 18, 115, 92, 57, 68, 102, 25, 7, 97, 32, 24, 
    28, 80, 27, 58, 14, 84, 74, 17, 16, 71, 75, 100, 77, 12, 111, 66, 
    81, 85, 26, 70, 82, 3, 4, 38, 89, 90, 109, 56, 13, 9, 37, 99, 62, 
    29, 96, 76, 33, 59, 31, 42, 52, 39, 40, 51, 91, 118, 79, 11, 23, 49,
    55, 43, 19, 110, 44 ],
    \[ 57, 47, 68, 42, 18, 93, 80, 75, 111, 40, 16, 101, 8, 78, 81, 48, 
    89, 45, 10, 110, 72, 64, 25, 23, 94, 60, 51, 17, 32, 88, 52, 109, 
    39, 66, 114, 98, 43, 4, 63, 54, 90, 28, 22, 55, 95, 44, 13, 27, 108,
    21, 102, 19, 34, 107, 37, 106, 41, 30, 20, 103, 100, 50, 24, 46, 67,
    6, 86, 87, 71, 112, 12, 35, 49, 115, 7, 1, 11, 85, 83, 2, 53, 91, 
    36, 62, 5, 58, 73, 118, 97, 61, 92, 26, 15, 33, 14, 99, 38, 105, 59,
    76, 119, 77, 116, 3, 113, 69, 31, 104, 74, 70, 29, 96, 117, 84, 9, 
    82, 79, 65, 56 ]
        /* order = 168 = 2^3 * 3 * 7 */ >;
    return omega, invol, isotrop_point, nonisotrop_point,
           nonisotrop_four, isotrop_plane, isotrop_line, nonisotrop_line,
           superfield, l2_7;
end function;

/******************************************************************/
//these are the good generators as described in Rob Wilson's Online
//ATLAS.
 
function FindGoodGens(g)
  found:= false;
  while not found do
    x:= Random(g);
    o:= Order(x);
    if IsEven(o) and #Centraliser(g, x^(o div 2)) eq 3072 then
      a:= x^(o div 2);
      found:= true;
    end if;
  end while;
  found:= false;
  while not found do
    x:= Random(g);
    o:= Order(x);
    if o mod 3 eq 0 and #Centraliser(g, x^(o div 3)) eq 648 then
      b:= x^(o div 3);
      found:= true;
    end if;
  end while;
  found:= false;
  while not found do
    x:= Random(g);
    a:= a^x; 
    if Order(a*b) eq 17 and Order(a*b*a*b^2) eq 17 and
         Order((a*b)^3*b) eq 30 then 
      return a, b;
    end if;
  end while;
end function;

/******************************************************************/
 
function OMinus8_2Identify(group: max:= true, Print:=0)

  omega, invol, isotrop_point, nonisotrop_point, nonisotrop_four,
  isotrop_plane, isotrop_line, nonisotrop_line, superfield, l2_7 :=
  GetGroups();
  F, phi := FPGroupStrong(omega);

  soc:= Socle(group);

  a, b:= FindGoodGens(soc);
  soc := sub<soc | a,b >;
  newgens := [ group | a,b];
  for g in Generators(group) do
     if not g in sub<group|newgens> then Append(~newgens,g); end if;
  end for;
  group := sub<group|newgens>;
  aom82 := sub<Sym(119)| omega.1, omega.2, invol >;
  ims := [ aom82 | omega.1, omega.2 ];
  homom :=  hom< soc -> omega | ims >;
  for i in [Ngens(soc)+1..Ngens(group)] do
      g := group.i;
      CG := aom82; ce := Id(aom82);
      for j in [1..2] do
        isc, h := IsConjugate(CG,omega.j^ce,homom(soc.j^g));
        if not isc then error "Conjugation error in Aut(O^-(8,2))"; end if;
        CG := Centraliser(CG,homom(soc.j^g));
        ce := ce*h;
      end for;
      Append(~ims,ce);
  end for;
  newgens := ims;
  for g in Generators(aom82) do
     if not g in sub<aom82|ims> then Append(~ims,g); end if; 
  end for;  
  aom82 := sub< Sym(119) | ims >;
  homom :=  hom< group -> aom82 | newgens >;


  if not max then
    return homom, aom82, [], F, phi;
  end if;

  //nothing fiddly here: extension is a .2 and all groups extend.
  maximals:= [x : x in [isotrop_point, nonisotrop_point,
  isotrop_plane, isotrop_line, nonisotrop_line, superfield,
  nonisotrop_four, l2_7]];

return homom, aom82, maximals, F, phi;
end function;


